#!/bin/sh
user="abocken@student-net.ethz.ch"
password_path="ETH/VPN"
if [ "$1" = "status" ]; then
	ping -c 2 -W 3 -q webprint.ethz.ch > /dev/null && printf 'ðŸ”¬'
	printf '\n'
else
	if [ $(pgrep -c openconnect) -eq 0 ]; then
		pass "$password_path" | sudo openconnect -g student-net -u "$user" --passwd-on-stdin sslvpn.ethz.ch &
		if ping -c 4 -W 6 -q webprint.ethz.ch ;then
			notify-send "ETH VPN" "ETH VPN connected"
		fi
	else
		if ping -c 1 -W 2 -q webprint.ethz.ch ;then
			sudo pkill openconnect && notify-send "ETH VPN" "ETH VPN disconnected"
		fi
	fi
	pkill -RTMIN+9 dwmblocks
fi
